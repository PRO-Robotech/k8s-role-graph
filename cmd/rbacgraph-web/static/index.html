<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RBAC Graph Review</title>
  <link rel="stylesheet" href="/static/vendor/reactflow-11.11.4.css" />
  <link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
  <div class="page">
    <h1>RBAC Graph Review</h1>
    <div class="subtitle">Aggregation API payload viewer (`/apis/rbacgraph.incloud.io/v1alpha1/rolegraphreviews`)</div>

    <nav aria-label="Query controls">
    <section class="panel">
      <div class="grid">
        <div>
          <label for="apiGroups">apiGroups (comma-separated)</label>
          <input id="apiGroups" value="" />
        </div>
        <div>
          <label for="resources">resources</label>
          <input id="resources" value="pods/exec" />
        </div>
        <div>
          <label for="verbs">verbs</label>
          <input id="verbs" value="get,create" />
        </div>
        <div>
          <label for="resourceNames">resourceNames</label>
          <input id="resourceNames" placeholder="optional" />
        </div>
        <div>
          <label for="nonResourceURLs">nonResourceURLs</label>
          <input id="nonResourceURLs" placeholder="optional" />
        </div>
        <div>
          <label for="matchMode">matchMode</label>
          <select id="matchMode">
            <option value="any" selected>any</option>
            <option value="all">all</option>
          </select>
        </div>
        <div>
          <label for="wildcardMode">wildcardMode</label>
          <select id="wildcardMode">
            <option value="expand" selected>expand</option>
            <option value="exact">exact</option>
          </select>
        </div>
        <div>
          <label for="podPhaseMode">podPhaseMode</label>
          <select id="podPhaseMode">
            <option value="active" selected>active</option>
            <option value="running">running</option>
            <option value="all">all</option>
          </select>
        </div>
        <div>
          <label for="maxPodsPerSubject">maxPodsPerSubject</label>
          <input id="maxPodsPerSubject" type="number" min="1" step="1" value="20" />
        </div>
        <div>
          <label for="maxWorkloadsPerPod">maxWorkloadsPerPod</label>
          <input id="maxWorkloadsPerPod" type="number" min="1" step="1" value="10" />
        </div>
        <div>
          <label for="namespaceScopeNamespaces">namespaceScope.namespaces (comma-separated)</label>
          <input id="namespaceScopeNamespaces" placeholder="optional, e.g. rbacgraph-demo,kube-system" />
        </div>
        <div>
          <label for="namespaceScopeStrict">namespaceScope.strict</label>
          <label style="display:flex; align-items:center; gap:8px; margin-top:10px; text-transform:none; letter-spacing:0;">
            <input id="namespaceScopeStrict" type="checkbox" style="width:auto;" />
            hide cluster-scoped nodes/bindings
          </label>
        </div>
        <div>
          <label for="impersonateUser">Impersonate User</label>
          <input id="impersonateUser" placeholder="optional, e.g. scope-tester" />
        </div>
        <div>
          <label for="impersonateGroup">Impersonate Group</label>
          <input id="impersonateGroup" placeholder="optional, e.g. system:masters" />
        </div>
      </div>

      <div class="actions">
        <label style="display:flex; align-items:center; gap:8px; margin:0; text-transform:none; letter-spacing:0;">
          <input type="checkbox" id="showAggregateEdges" style="width:auto;" checked />
          show aggregation links
        </label>
        <label style="display:flex; align-items:center; gap:8px; margin:0; text-transform:none; letter-spacing:0;">
          <input type="checkbox" id="onlyReachable" style="width:auto;" />
          only reachable (with bindings)
        </label>
        <label style="display:flex; align-items:center; gap:8px; margin:0; text-transform:none; letter-spacing:0;">
          <input type="checkbox" id="showRolePermissions" style="width:auto;" checked />
          show permissions in role cards
        </label>
        <label style="display:flex; align-items:center; gap:8px; margin:0; text-transform:none; letter-spacing:0;">
          <input type="checkbox" id="showPermissions" style="width:auto;" />
          show permissions lane (role -> permission -> binding)
        </label>
        <label style="display:flex; align-items:center; gap:8px; margin:0; text-transform:none; letter-spacing:0;">
          <input type="checkbox" id="spreadEdges" style="width:auto;" checked />
          spread parallel edges
        </label>
        <label style="display:flex; align-items:center; gap:8px; margin:0; text-transform:none; letter-spacing:0;">
          <input type="checkbox" id="focusMode" style="width:auto;" checked />
          focus mode (click card)
        </label>
        <label style="display:flex; align-items:center; gap:8px; margin:0; text-transform:none; letter-spacing:0;">
          <input type="checkbox" id="includePods" style="width:auto;" />
          include pods
        </label>
        <label style="display:flex; align-items:center; gap:8px; margin:0; text-transform:none; letter-spacing:0;">
          <input type="checkbox" id="includeWorkloads" style="width:auto;" />
          include workloads
        </label>
        <label style="display:flex; align-items:center; gap:8px; margin:0; text-transform:none; letter-spacing:0;">
          <input type="checkbox" id="filterPhantomAPIs" style="width:auto;" />
          filter phantom APIs
        </label>
        <label style="display:flex; align-items:center; gap:8px; margin:0; text-transform:none; letter-spacing:0;">
          runtime view
          <select id="runtimeView" style="width:auto; min-width:220px; padding:6px 8px;">
            <option value="access" selected>access-first (Subject -> Pod -> Workload)</option>
            <option value="ownership">ownership-first (Workload -> Pod)</option>
          </select>
        </label>
        <label style="display:flex; align-items:center; gap:8px; margin:0; text-transform:none; letter-spacing:0;">
          horizontal spacing
          <select id="laneSpacing" style="width:auto; min-width:130px; padding:6px 8px;">
            <option value="420">compact</option>
            <option value="540">normal</option>
            <option value="660" selected>wide</option>
            <option value="760">extra-wide</option>
          </select>
        </label>
        <label style="display:flex; align-items:center; gap:8px; margin:0; text-transform:none; letter-spacing:0;">
          vertical spacing
          <select id="rowSpacing" style="width:auto; min-width:130px; padding:6px 8px;">
            <option value="36">compact</option>
            <option value="52">normal</option>
            <option value="70" selected>wide</option>
            <option value="88">extra-wide</option>
          </select>
        </label>
        <label style="display:flex; align-items:center; gap:8px; margin:0; text-transform:none; letter-spacing:0;">
          <input type="checkbox" id="autoFit" style="width:auto;" />
          auto fit graph
        </label>
        <button id="fitGraph" class="btn-secondary" type="button">Fit Graph</button>
        <label style="display:flex; align-items:center; gap:8px; margin:0; text-transform:none; letter-spacing:0;">
          canvas height
          <select id="canvasHeight" style="width:auto; min-width:110px; padding:6px 8px;">
            <option value="760">760</option>
            <option value="900">900</option>
            <option value="1000">1000</option>
            <option value="1100">1100</option>
            <option value="1300" selected>1300</option>
            <option value="1500">1500</option>
            <option value="1800">1800</option>
          </select>
        </label>
        <button id="run">Run Query</button>
        <div id="status" class="status" aria-live="polite"></div>
      </div>

      <div class="selector-builder">
        <div class="selector-builder-head">
          <div class="selector-builder-title">Selector Builder</div>
          <button id="discoverOptions" class="btn-secondary" type="button">Discover from cluster</button>
          <button id="clearSelectorChecks" class="btn-secondary" type="button">Clear checks</button>
          <div id="selectorSummary" class="selector-summary">selected: verbs=0, apiGroups=0, resources=0, nonResourceURLs=0</div>
          <div id="selectorDiscoverStatus" class="selector-status">Use checkboxes and/or comma-separated fields above.</div>
        </div>
        <div class="selector-grid">
          <div class="selector-group">
            <div class="selector-group-head">
              <span class="selector-group-name">verbs</span>
              <span id="selectorCountVerbs">0 / 0</span>
            </div>
            <input id="selectorFilterVerbs" class="selector-filter" placeholder="filter verbs" />
            <div id="selectorListVerbs" class="selector-list">
              <div class="selector-empty">No discovered values yet</div>
            </div>
          </div>
          <div class="selector-group">
            <div class="selector-group-head">
              <span class="selector-group-name">apiGroups</span>
              <span id="selectorCountAPIGroups">0 / 0</span>
            </div>
            <input id="selectorFilterAPIGroups" class="selector-filter" placeholder="filter api groups" />
            <div id="selectorListAPIGroups" class="selector-list">
              <div class="selector-empty">No discovered values yet</div>
            </div>
          </div>
          <div class="selector-group">
            <div class="selector-group-head">
              <span class="selector-group-name">resources</span>
              <span id="selectorCountResources">0 / 0</span>
            </div>
            <input id="selectorFilterResources" class="selector-filter" placeholder="filter resources (e.g. pods/exec)" />
            <div id="selectorListResources" class="selector-list">
              <div class="selector-empty">No discovered values yet</div>
            </div>
          </div>
          <div class="selector-group">
            <div class="selector-group-head">
              <span class="selector-group-name">nonResourceURLs</span>
              <span id="selectorCountNonResourceURLs">0 / 0</span>
            </div>
            <input id="selectorFilterNonResourceURLs" class="selector-filter" placeholder="filter non-resource URLs" />
            <div id="selectorListNonResourceURLs" class="selector-list">
              <div class="selector-empty">No discovered values yet</div>
            </div>
          </div>
        </div>
      </div>

      <div id="warnings" class="chips" role="status"></div>
      <div id="gaps" class="chips" role="status"></div>
    </section>
    </nav>

    <main>
    <section class="panel graph-panel">
      <div class="graph-head">
        <div id="stats" class="subtitle" style="margin-top:0;" role="status" aria-live="polite">No query yet</div>
        <div class="graph-legend">
          <span class="legend-item"><span class="legend-line grants"></span>grants</span>
          <span class="legend-item"><span class="legend-line binds"></span>binds</span>
          <span class="legend-item"><span class="legend-line permissions"></span>permission path (role -> permission -> binding)</span>
          <span class="legend-item"><span class="legend-line runsas"></span><span id="legendRunsAsText">subject -> pod (runsAs)</span></span>
          <span class="legend-item"><span class="legend-line ownedby"></span><span id="legendOwnedByText">pod -> workload owner chain (ownedBy)</span></span>
          <span class="legend-item"><span class="legend-line aggregates"></span>aggregates</span>
          <span class="legend-item">direction: left -> right</span>
        </div>
      </div>
      <div class="graph-wrap">
        <div id="flowRoot" class="flow-root"></div>
      </div>
    </section>

    <section class="panel">
      <h2 style="margin:0;font-size:1rem;">Resource Map</h2>
      <table>
        <thead>
          <tr>
            <th>apiGroup</th>
            <th>resource</th>
            <th>verb</th>
            <th>roles</th>
            <th>bindings</th>
            <th>subjects</th>
          </tr>
        </thead>
        <tbody id="resourceMapBody"></tbody>
      </table>
    </section>

    <section class="panel">
      <div class="raw-grid">
        <div class="raw-card">
          <div class="raw-head">
            <h2>Raw Request</h2>
            <div style="display:flex; gap:8px; align-items:center;">
              <select id="requestView" class="view-select">
                <option value="pretty" selected>Pretty</option>
                <option value="raw">Raw</option>
              </select>
              <button id="copyRequest" class="btn-secondary" type="button">Copy</button>
            </div>
          </div>
          <div class="raw-meta">POST /apis/rbacgraph.incloud.io/v1alpha1/rolegraphreviews</div>
          <textarea id="rawRequest" class="raw-box" readonly></textarea>
        </div>
        <div class="raw-card">
          <div class="raw-head">
            <h2>Raw Response</h2>
            <div style="display:flex; gap:8px; align-items:center;">
              <select id="responseView" class="view-select">
                <option value="pretty" selected>Pretty</option>
                <option value="raw">Raw</option>
              </select>
              <button id="copyResponse" class="btn-secondary" type="button">Copy</button>
            </div>
          </div>
          <div id="rawResponseMeta" class="raw-meta">No response yet</div>
          <textarea id="rawResponse" class="raw-box" readonly></textarea>
        </div>
      </div>
    </section>
    </main>
  </div>

  <div id="roleModal" class="rf-modal-overlay" style="display:none" role="dialog" aria-modal="true" aria-labelledby="roleModalTitle" onclick="if(event.target===this)closeRoleModal()">
    <div class="rf-modal">
      <div class="rf-modal-header">
        <span id="roleModalTitle" class="rf-modal-title"></span>
        <button class="rf-modal-close" aria-label="Close" onclick="closeRoleModal()">&times;</button>
      </div>
      <div class="rf-modal-body">
        <div class="rf-modal-col" id="roleModalOriginal">
          <h4>Original Rules</h4>
        </div>
        <div class="rf-modal-col" id="roleModalExpanded">
          <h4>Expanded Permissions</h4>
        </div>
      </div>
    </div>
  </div>

  <script src="/static/vendor/react-18.3.1.min.js"></script>
  <script src="/static/vendor/react-dom-18.3.1.min.js"></script>
  <script src="/static/vendor/reactflow-11.11.4.umd.js"></script>
  <script src="/static/app.js"></script>
</body>
</html>
